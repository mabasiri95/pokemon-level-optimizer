import React, { useState } from 'react';
import { ArrowUp, Zap, Coins } from 'lucide-react';

const PokemonOptimizer = () => {
  const [pokemon, setPokemon] = useState([
    { id: 1, level: 34, pointsPerLevel: 65, name: 'Pokemon 1' },
    { id: 2, level: 23, pointsPerLevel: 50, name: 'Pokemon 2' },
    { id: 3, level: 30, pointsPerLevel: 60, name: 'Pokemon 3' },
    { id: 4, level: 29, pointsPerLevel: 60, name: 'Pokemon 4' },
    { id: 5, level: 1, pointsPerLevel: 60, name: 'Pokemon 5' }
  ]);
  const [targetPoints, setTargetPoints] = useState(10000);
  const [result, setResult] = useState(null);

  const calculateCurrentPoints = (pkmn) => {
    return pkmn.reduce((sum, p) => sum + (p.level * p.pointsPerLevel), 0);
  };

  const calculateEfficiency = (level, pointsPerLevel) => {
    return pointsPerLevel / level;
  };

  const optimizeLeveling = () => {
    const pkmnCopy = pokemon.map(p => ({ ...p }));
    let currentPoints = calculateCurrentPoints(pkmnCopy);
    let totalCoins = 0;
    const levelingSequence = [];

    while (currentPoints < targetPoints) {
      // Find Pokemon with best efficiency
      let bestIdx = 0;
      let bestEfficiency = calculateEfficiency(pkmnCopy[0].level, pkmnCopy[0].pointsPerLevel);

      for (let i = 1; i < pkmnCopy.length; i++) {
        const efficiency = calculateEfficiency(pkmnCopy[i].level, pkmnCopy[i].pointsPerLevel);
        if (efficiency > bestEfficiency) {
          bestEfficiency = efficiency;
          bestIdx = i;
        }
      }

      // Level up the best Pokemon
      const selectedPokemon = pkmnCopy[bestIdx];
      const costToLevel = selectedPokemon.level;
      const pointsGained = selectedPokemon.pointsPerLevel;

      levelingSequence.push({
        pokemon: selectedPokemon.name,
        fromLevel: selectedPokemon.level,
        toLevel: selectedPokemon.level + 1,
        cost: costToLevel,
        pointsGained: pointsGained,
        efficiency: bestEfficiency.toFixed(3),
        totalPoints: currentPoints + pointsGained,
        totalCoins: totalCoins + costToLevel
      });

      selectedPokemon.level += 1;
      currentPoints += pointsGained;
      totalCoins += costToLevel;

      // Safety check to prevent infinite loop
      if (levelingSequence.length > 10000) {
        break;
      }
    }

    setResult({
      finalLevels: pkmnCopy,
      totalCoins,
      finalPoints: currentPoints,
      sequence: levelingSequence
    });
  };

  const updatePokemon = (id, field, value) => {
    setPokemon(pokemon.map(p => 
      p.id === id ? { ...p, [field]: parseInt(value) || 0 } : p
    ));
    setResult(null);
  };

  const currentPoints = calculateCurrentPoints(pokemon);

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-8">
      <div className="max-w-6xl mx-auto">
        <h1 className="text-4xl font-bold text-center mb-8 text-purple-900">
          Pokemon Level Optimizer
        </h1>

        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
          <h2 className="text-2xl font-semibold mb-4 flex items-center gap-2">
            <Zap className="text-yellow-500" />
            Your Pokemon
          </h2>
          
          <div className="grid gap-4 mb-6">
            {pokemon.map((p) => (
              <div key={p.id} className="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                <div className="flex-1">
                  <span className="font-semibold">{p.name}</span>
                </div>
                <div className="flex items-center gap-2">
                  <label className="text-sm text-gray-600">Level:</label>
                  <input
                    type="number"
                    value={p.level}
                    onChange={(e) => updatePokemon(p.id, 'level', e.target.value)}
                    className="w-20 px-2 py-1 border rounded"
                    min="1"
                  />
                </div>
                <div className="flex items-center gap-2">
                  <label className="text-sm text-gray-600">Points/Level:</label>
                  <input
                    type="number"
                    value={p.pointsPerLevel}
                    onChange={(e) => updatePokemon(p.id, 'pointsPerLevel', e.target.value)}
                    className="w-20 px-2 py-1 border rounded"
                    min="1"
                  />
                </div>
                <div className="text-sm text-gray-600">
                  Current: {p.level * p.pointsPerLevel} pts
                </div>
                <div className="text-sm font-semibold text-purple-600">
                  Efficiency: {calculateEfficiency(p.level, p.pointsPerLevel).toFixed(3)}
                </div>
              </div>
            ))}
          </div>

          <div className="flex items-center gap-4 mb-6">
            <label className="font-semibold">Target Points:</label>
            <input
              type="number"
              value={targetPoints}
              onChange={(e) => setTargetPoints(parseInt(e.target.value) || 0)}
              className="w-32 px-3 py-2 border rounded"
              min="0"
            />
            <div className="text-lg">
              Current Points: <span className="font-bold text-blue-600">{currentPoints}</span>
            </div>
            <div className="text-lg">
              Points Needed: <span className="font-bold text-red-600">{Math.max(0, targetPoints - currentPoints)}</span>
            </div>
          </div>

          <button
            onClick={optimizeLeveling}
            className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg flex items-center justify-center gap-2 transition"
          >
            <ArrowUp />
            Calculate Optimal Leveling Strategy
          </button>
        </div>

        {result && (
          <div className="bg-white rounded-lg shadow-lg p-6">
            <h2 className="text-2xl font-semibold mb-4 flex items-center gap-2">
              <Coins className="text-yellow-500" />
              Optimization Results
            </h2>

            <div className="grid grid-cols-3 gap-4 mb-6">
              <div className="bg-green-50 p-4 rounded-lg text-center">
                <div className="text-3xl font-bold text-green-600">{result.totalCoins}</div>
                <div className="text-sm text-gray-600">Total Coins Needed</div>
              </div>
              <div className="bg-blue-50 p-4 rounded-lg text-center">
                <div className="text-3xl font-bold text-blue-600">{result.finalPoints}</div>
                <div className="text-sm text-gray-600">Final Points</div>
              </div>
              <div className="bg-purple-50 p-4 rounded-lg text-center">
                <div className="text-3xl font-bold text-purple-600">{result.sequence.length}</div>
                <div className="text-sm text-gray-600">Levels Gained</div>
              </div>
            </div>

            <h3 className="text-xl font-semibold mb-3">Final Pokemon Levels</h3>
            <div className="grid gap-2 mb-6">
              {result.finalLevels.map((p) => (
                <div key={p.id} className="flex items-center justify-between p-3 bg-gray-50 rounded">
                  <span className="font-semibold">{p.name}</span>
                  <span>Level {pokemon.find(pk => pk.id === p.id).level} → {p.level}</span>
                  <span className="text-blue-600 font-semibold">{p.level * p.pointsPerLevel} points</span>
                </div>
              ))}
            </div>

            <h3 className="text-xl font-semibold mb-3">Leveling Sequence (First 20 steps)</h3>
            <div className="max-h-96 overflow-y-auto">
              <table className="w-full text-sm">
                <thead className="bg-gray-100 sticky top-0">
                  <tr>
                    <th className="p-2 text-left">Step</th>
                    <th className="p-2 text-left">Pokemon</th>
                    <th className="p-2 text-left">Level Up</th>
                    <th className="p-2 text-right">Cost</th>
                    <th className="p-2 text-right">Points Gained</th>
                    <th className="p-2 text-right">Efficiency</th>
                    <th className="p-2 text-right">Total Points</th>
                    <th className="p-2 text-right">Total Coins</th>
                  </tr>
                </thead>
                <tbody>
                  {result.sequence.slice(0, 20).map((step, idx) => (
                    <tr key={idx} className="border-b hover:bg-gray-50">
                      <td className="p-2">{idx + 1}</td>
                      <td className="p-2">{step.pokemon}</td>
                      <td className="p-2">{step.fromLevel} → {step.toLevel}</td>
                      <td className="p-2 text-right">{step.cost}</td>
                      <td className="p-2 text-right text-green-600">+{step.pointsGained}</td>
                      <td className="p-2 text-right">{step.efficiency}</td>
                      <td className="p-2 text-right font-semibold">{step.totalPoints}</td>
                      <td className="p-2 text-right font-semibold">{step.totalCoins}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
              {result.sequence.length > 20 && (
                <div className="text-center p-4 text-gray-500">
                  ... and {result.sequence.length - 20} more steps
                </div>
              )}
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default PokemonOptimizer;